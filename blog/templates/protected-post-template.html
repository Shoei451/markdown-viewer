<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Protected Post â€” Shoei451</title>
  <link rel="icon" type="image/png" href="../../images/favicon-md.png" />
  <link rel="stylesheet" href="../../css/common.css" />
  
  <!-- KaTeX for math rendering -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  
  <link rel="stylesheet" href="../../css/protected-post-style.css">
</head>

<body>

<!-- Theme Toggle -->
<span class="logo-switches">
  <button id="theme-toggle" title="Toggle Theme">
    <svg id="moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
    </svg>
    <svg id="sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </button>
</span>

<!-- Password Overlay -->
<div class="password-overlay" id="password-overlay">
  <div class="password-dialog">
    <span class="password-icon">ğŸ”’</span>
    <h2>ã“ã®è¨˜äº‹ã¯ä¿è­·ã•ã‚Œã¦ã„ã¾ã™</h2>
    <p>é–²è¦§ã™ã‚‹ã«ã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
    
    <form id="password-form">
      <div class="password-input-group">
        <input 
          type="password" 
          id="password-input" 
          class="password-input" 
          placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›"
          autocomplete="off"
          required
        />
      </div>
      <button type="submit" class="password-submit">
        <span id="submit-text">è¨˜äº‹ã‚’è¡¨ç¤º</span>
        <div class="loading-spinner" id="loading-spinner"></div>
      </button>
    </form>
    
    <p class="password-error" id="password-error">
      âš ï¸ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“
    </p>
  </div>
</div>

<!-- Main Content -->
<main class="post-wrapper">
  <a href="../../index.html" class="back-link">â† Back to Blog</a>
  
  <div class="post-header">
    <h1 id="post-title">
      è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«
      <span class="protected-indicator">ğŸ”’ Protected</span>
    </h1>
    
    <div class="post-meta">
      <span class="post-meta-item">ğŸ“… <span id="post-date">2026-01-13</span></span>
      <span class="post-meta-item">â±ï¸ <span id="read-time">5</span> min read</span>
    </div>
    <div class="post-tags" id="post-tags">
      <!-- Tags will be inserted here -->
    </div>
  </div>

  <article class="markdown-content" id="markdown-content">
    <!-- Markdown content will be loaded here after password verification -->
    <div style="text-align: center; padding: 60px 20px; color: var(--secondary);">
      <p>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦è¨˜äº‹ã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„</p>
    </div>
  </article>
</main>

<footer>
  <p>Get in touch: <a href="mailto:okamotoshoei451@gmail.com">okamotoshoei451@gmail.com</a></p>
</footer>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="../../js/theme-toggle.js"></script>
<script src="../../js/supabase-client.js"></script>
<script src="../../js/markdown-renderer.js"></script>

<script>
// ==========================================
// Post Configuration
// ==========================================
const POST_CONFIG = {
  slug: 'example-protected-post',  // Supabaseã®slugã¨ä¸€è‡´ã•ã›ã‚‹
  category: 'math',                 // ã‚«ãƒ†ã‚´ãƒª
  SUPABASE_URL: 'https://gjuqsyaugrsshmjerhme.supabase.co',
  SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdqdXFzeWF1Z3Jzc2htamVyaG1lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY0NzA3NTYsImV4cCI6MjA4MjA0Njc1Nn0.V8q5ddz5tPy7wBaQ73aGtmCZyqzA6pPciPRwRIZjJcs'
};

// ==========================================
// Initialize
// ==========================================
const supabaseClient = new SupabaseClient(
  POST_CONFIG.SUPABASE_URL, 
  POST_CONFIG.SUPABASE_ANON_KEY
);

const passwordForm = document.getElementById('password-form');
const passwordInput = document.getElementById('password-input');
const passwordError = document.getElementById('password-error');
const passwordOverlay = document.getElementById('password-overlay');
const loadingSpinner = document.getElementById('loading-spinner');
const submitText = document.getElementById('submit-text');
const contentElement = document.getElementById('markdown-content');

// ==========================================
// Password Form Handler
// ==========================================
passwordForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const password = passwordInput.value;
  
  // UIæ›´æ–°
  passwordError.classList.remove('show');
  loadingSpinner.classList.add('show');
  submitText.style.display = 'none';
  
  try {
    // Supabaseã‹ã‚‰è¨˜äº‹ã‚’å–å¾—
    const result = await supabaseClient.getProtectedPost(POST_CONFIG.slug, password);
    
    if (result.success) {
      // æˆåŠŸï¼šè¨˜äº‹ã‚’è¡¨ç¤º
      const post = result.post;
      
      // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®š
      document.getElementById('post-title').innerHTML = `
        ${post.title}
        <br><span class="protected-indicator">ğŸ”’ Protected</span>
      `;
      document.getElementById('post-date').textContent = new Date(post.created_at).toLocaleDateString('ja-JP');
      document.title = `${post.title} â€” Shoei451`;
      
      // ã‚¿ã‚°ã‚’è¡¨ç¤º
      const tagsContainer = document.getElementById('post-tags');
      tagsContainer.innerHTML = '';
      post.tags.forEach(tag => {
        const tagEl = document.createElement('span');
        tagEl.className = 'post-tag';
        tagEl.textContent = tag;
        tagsContainer.appendChild(tagEl);
      });
      
      // Markdownã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
      await markdownRenderer.render(post.content, contentElement);
      
      // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’éè¡¨ç¤º
      passwordOverlay.classList.add('hidden');
      
      // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ï¼ˆãƒªãƒ­ãƒ¼ãƒ‰æ™‚ã«å†å…¥åŠ›ä¸è¦ï¼‰
      sessionStorage.setItem(`post_${POST_CONFIG.slug}`, password);
      
    } else {
      // å¤±æ•—ï¼šã‚¨ãƒ©ãƒ¼è¡¨ç¤º
      passwordError.classList.add('show');
      passwordInput.value = '';
      passwordInput.focus();
    }
    
  } catch (error) {
    console.error('Error:', error);
    passwordError.textContent = 'âš ï¸ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
    passwordError.classList.add('show');
  } finally {
    // UIå¾©å…ƒ
    loadingSpinner.classList.remove('show');
    submitText.style.display = 'inline';
  }
});

// ==========================================
// Auto-load if password exists in session
// ==========================================
window.addEventListener('DOMContentLoaded', async () => {
  const savedPassword = sessionStorage.getItem(`post_${POST_CONFIG.slug}`);
  
  if (savedPassword) {
    passwordInput.value = savedPassword;
    passwordForm.dispatchEvent(new Event('submit'));
  } else {
    // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
    passwordInput.focus();
  }
});
</script>

</body>
</html>