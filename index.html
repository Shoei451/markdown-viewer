<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Markdown Viewer â€” Shoei451</title>
  <link rel="icon" type="image/png" href="images/favicon-md.png" />
  <link rel="stylesheet" href="css/common.css" />
  
  <style>
    /* Blog-specific styles */
    .blog-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 30px;
      max-width: 1200px;
      margin: 0 auto 100px;
      padding: 0 20px;
    }

    .blog-card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 30px var(--shadow);
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      border: 2px solid transparent;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
    }

    .blog-card.protected {
      border-color: var(--magenta);
      background: linear-gradient(135deg, var(--card-bg) 0%, var(--card-bg) 100%);
    }

    .blog-card.protected::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(211, 54, 130, 0.05) 0%, rgba(108, 113, 196, 0.05) 100%);
      pointer-events: none;
    }

    .blog-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 20px 40px var(--shadow);
      border-color: var(--accent);
    }

    .blog-card.protected:hover {
      border-color: var(--magenta);
    }

    .protected-badge {
      position: absolute;
      top: 15px;
      right: 15px;
      background: linear-gradient(135deg, var(--magenta) 0%, var(--violet) 100%);
      color: #ffffff;
      padding: 5px 12px;
      border-radius: 15px;
      font-size: 0.75rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 4px;
      box-shadow: 0 4px 15px rgba(211, 54, 130, 0.3);
    }

    .blog-date {
      font-size: 0.9rem;
      color: var(--accent);
      font-weight: 600;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 5px;
      position: relative;
      z-index: 1;
    }

    .blog-card h3 {
      font-size: 1.5rem;
      color: var(--primary);
      margin: 0 0 15px 0;
      line-height: 1.4;
      position: relative;
      z-index: 1;
    }

    .blog-card p {
      color: var(--secondary);
      line-height: 1.6;
      margin: 0 0 20px 0;
      flex-grow: 1;
      position: relative;
      z-index: 1;
    }

    .blog-category {
      display: inline-block;
      background: var(--theme);
      color: var(--secondary);
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.8rem;
      margin-bottom: 10px;
      border: 1px solid var(--shadow);
      position: relative;
      z-index: 1;
    }

    .blog-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 15px;
      position: relative;
      z-index: 1;
    }

    .blog-tag {
      background: var(--theme);
      color: var(--primary);
      padding: 4px 12px;
      border-radius: 15px;
      font-size: 0.85rem;
      border: 1px solid var(--shadow);
    }

    .read-more {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      color: var(--accent);
      font-weight: 600;
      transition: gap 0.3s;
      position: relative;
      z-index: 1;
    }

    .blog-card.protected .read-more {
      color: var(--magenta);
    }

    .blog-card:hover .read-more {
      gap: 10px;
    }

    .filter-container {
      max-width: 1200px;
      margin: 40px auto 40px;
      padding: 0 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    .filter-btn {
      padding: 10px 20px;
      background: var(--card-bg);
      color: var(--primary);
      border: 2px solid transparent;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
      font-size: 0.95rem;
    }

    .filter-btn:hover {
      border-color: var(--accent);
      transform: translateY(-2px);
    }

    .filter-btn.active {
      background: var(--accent);
      color: #ffffff;
      border-color: var(--accent);
    }

    @media (max-width: 768px) {
      .blog-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>

<!-- Theme Toggle -->
<span class="logo-switches">
  <button id="theme-toggle" title="Toggle Theme">
    <svg id="moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
    </svg>
    <svg id="sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </button>
</span>

<header>
  <img src="images/favicon-md.png" alt="Markdown Icon" width="200" />
  <h1>ğŸ“‘ Markdown Viewer</h1>
  <p>Display Markdown files in a clean, readable format</p>
</header>

<main class="intro">
  <h2>Recent Posts</h2>
  <p>å­¦ç¿’ä¸­ã®æ°—ã¥ãã‚„ãƒ¡ãƒ¢ã‚’ã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚</p>
</main>

<!-- Filter Buttons -->
<section class="filter-container">
  <button class="filter-btn active" data-filter="all">All</button>
  <button class="filter-btn" data-filter="math">æ•°å­¦</button>
  <button class="filter-btn" data-filter="english">è‹±èª</button>
  <button class="filter-btn" data-filter="history">æ­´å²</button>
  <button class="filter-btn" data-filter="programming">ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°</button>
  <button class="filter-btn" data-filter="protected">ğŸ”’ Protected</button>
</section>

<!-- Blog Posts Grid -->
<section class="blog-grid" id="blog-grid">
  <!-- Blog cards will be generated by JavaScript -->
</section>

<footer>
  <p>Get in touch: <a href="mailto:okamotoshoei451@gmail.com">okamotoshoei451@gmail.com</a></p>
</footer>

<script src="js/theme-toggle.js"></script>
<script src="js/supabase-client.js"></script>

<script>
// ==========================================
// Configuration
// ==========================================
const SUPABASE_CONFIG = {
  url: 'https://gjuqsyaugrsshmjerhme.supabase.co',
  anonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdqdXFzeWF1Z3Jzc2htamVyaG1lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY0NzA3NTYsImV4cCI6MjA4MjA0Njc1Nn0.V8q5ddz5tPy7wBaQ73aGtmCZyqzA6pPciPRwRIZjJcs'
};

// Tag labels for display
const tagLabels = {
  math: 'æ•°å­¦',
  english: 'è‹±èª',
  history: 'æ­´å²',
  programming: 'ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°',
  calculus: 'å¾®ç©åˆ†',
  presentation: 'ãƒ—ãƒ¬ã‚¼ãƒ³',
  wwii: 'ç¬¬äºŒæ¬¡ä¸–ç•Œå¤§æˆ¦',
  javascript: 'JavaScript'
};

// Category labels
const categoryLabels = {
  math: 'æ•°å­¦',
  english: 'è‹±èª',
  history: 'æ­´å²',
  programming: 'ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°'
};

// ==========================================
// Public Blog Posts (stored in files)
// ==========================================
const publicPosts = [
  {
    id: "post-1",
    title: "å¾®åˆ†ç©åˆ†ã®åŸºç¤",
    date: "2026-01-13",
    category: "math",
    tags: ["math", "calculus"],
    excerpt: "å¾®åˆ†ã¨ç©åˆ†ã®åŸºæœ¬çš„ãªæ¦‚å¿µã‚’æ•°å¼ã‚’ä½¿ã£ã¦è§£èª¬ã€‚æ¥µé™ã®å®šç¾©ã‹ã‚‰å§‹ã‚ã¦å°é–¢æ•°ã®è¨ˆç®—æ–¹æ³•ã¾ã§ã€‚",
    file: "blog/math/post-1.html",
    protected: false
  },
  {
    id: "post-2",
    title: "è‹±èªãƒ—ãƒ¬ã‚¼ãƒ³ã®ã‚³ãƒ„",
    date: "2026-01-10",
    category: "english",
    tags: ["english", "presentation"],
    excerpt: "å­¦æ ¡ã§ã®ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§å­¦ã‚“ã åŠ¹æœçš„ãªè‹±èªè¡¨ç¾ã¨æ§‹æˆæ–¹æ³•ã«ã¤ã„ã¦",
    file: "blog/english/post-2.html",
    protected: false
  },
  {
    id: "post-3",
    title: "ç¬¬äºŒæ¬¡ä¸–ç•Œå¤§æˆ¦ã®å¤šè§’çš„è¦–ç‚¹",
    date: "2026-01-08",
    category: "history",
    tags: ["history", "wwii"],
    excerpt: "æ—¥æœ¬ã€ã‚¢ãƒ¡ãƒªã‚«ã€ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ã®è¦–ç‚¹ã‹ã‚‰ç¬¬äºŒæ¬¡ä¸–ç•Œå¤§æˆ¦ã‚’è€ƒå¯Ÿã€‚ç•°ãªã‚‹æ­´å²å™è¿°ã®æ¯”è¼ƒ",
    file: "blog/history/post-3.html",
    protected: false
  },
  {
    id: "post-4",
    title: "JavaScriptã®éåŒæœŸå‡¦ç†",
    date: "2026-01-05",
    category: "programming",
    tags: ["programming", "javascript"],
    excerpt: "Promiseã€async/awaitã®ä»•çµ„ã¿ã¨ä½¿ã„æ–¹ã«ã¤ã„ã¦è§£èª¬",
    file: "blog/programming/post-4.html",
    protected: false
  }
];

// ==========================================
// Generate Blog Cards
// ==========================================
const blogGrid = document.getElementById('blog-grid');

function createPostCard(post) {
  const card = document.createElement('a');
  card.href = post.file;
  card.className = `blog-card${post.protected ? ' protected' : ''}`;
  card.setAttribute('data-category', post.category);
  card.setAttribute('data-tags', post.tags.join(' '));
  
  const categoryLabel = categoryLabels[post.category] || post.category;
  
  let cardHTML = `
    <div class="blog-category">${categoryLabel}</div>
  `;
  
  if (post.protected) {
    cardHTML += `<div class="protected-badge">ğŸ”’ Protected</div>`;
  }
  
  cardHTML += `
    <div class="blog-date">ğŸ“… ${post.date}</div>
    <h3>${post.title}</h3>
    <div class="blog-tags">
      ${post.tags.map(tag => `<span class="blog-tag">${tagLabels[tag] || tag}</span>`).join('')}
    </div>
    <p>${post.excerpt}</p>
    <span class="read-more">${post.protected ? 'ğŸ”“ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦èª­ã‚€' : 'è¨˜äº‹ã‚’èª­ã‚€ â†’'}</span>
  `;
  
  card.innerHTML = cardHTML;
  return card;
}

function renderPosts(posts) {
  blogGrid.innerHTML = '';
  posts.forEach(post => {
    blogGrid.appendChild(createPostCard(post));
  });
}

// ==========================================
// Load Protected Posts from Supabase
// ==========================================
async function loadProtectedPosts() {
  try {
    const supabaseClient = new SupabaseClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.anonKey);
    const result = await supabaseClient.getProtectedPostsMeta();
    
    if (result.success && result.posts.length > 0) {
      const protectedPosts = result.posts.map(post => ({
        id: post.slug,
        title: post.title,
        date: new Date(post.created_at).toLocaleDateString('ja-JP'),
        category: post.category,
        tags: post.tags || [],
        excerpt: `ğŸ”’ ã“ã®è¨˜äº‹ã¯ä¿è­·ã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦é–²è¦§ã—ã¦ãã ã•ã„ã€‚`,
        file: `blog/${post.category}/protected-${post.slug}.html`,
        protected: true
      }));
      
      return protectedPosts;
    }
    return [];
  } catch (error) {
    console.error('Error loading protected posts:', error);
    return [];
  }
}

// ==========================================
// Initialize
// ==========================================
async function initialize() {
  // Load protected posts
  const protectedPosts = await loadProtectedPosts();
  
  // Combine all posts
  const allPosts = [...publicPosts, ...protectedPosts].sort((a, b) => {
    return new Date(b.date) - new Date(a.date);
  });
  
  // Initial render
  renderPosts(allPosts);
  
  // Setup filters
  setupFilters(allPosts);
}

// ==========================================
// Filter Functionality
// ==========================================
function setupFilters(allPosts) {
  const filterBtns = document.querySelectorAll('.filter-btn');
  
  filterBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      // Update active state
      filterBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      const filter = btn.getAttribute('data-filter');
      
      let filtered;
      if (filter === 'all') {
        filtered = allPosts;
      } else if (filter === 'protected') {
        filtered = allPosts.filter(post => post.protected);
      } else {
        filtered = allPosts.filter(post => 
          post.category === filter || post.tags.includes(filter)
        );
      }
      
      renderPosts(filtered);
    });
  });
}

// ==========================================
// Animation on scroll
// ==========================================
const observer = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      entry.target.style.animation = 'fadeInUp 0.6s ease-out forwards';
      observer.unobserve(entry.target);
    }
  });
}, { threshold: 0.1 });

// Re-observe on render
const originalRender = renderPosts;
renderPosts = function(posts) {
  originalRender(posts);
  document.querySelectorAll('.blog-card').forEach(card => {
    observer.observe(card);
  });
};

// Start
initialize();
</script>

</body>
</html>